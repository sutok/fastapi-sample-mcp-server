# 帳票設計仕様書（MUI 準拠）

## 1. 共通帳票コンポーネント

### 1.1 帳票ベースレイアウト

```tsx
// components/reports/ReportLayout.tsx
const ReportLayout: React.FC = ({ children }) => {
  return (
    <Paper sx={{ p: 3, width: "100%" }}>
      <Box sx={{ mb: 3 }}>
        <Typography variant="h5" component="h2">
          {title}
        </Typography>
        <Divider sx={{ my: 2 }} />
      </Box>
      {children}
      <Box sx={{ mt: 3, textAlign: "right" }}>
        <Typography variant="caption">
          出力日時: {new Date().toLocaleString()}
        </Typography>
      </Box>
    </Paper>
  );
};
```

### 1.2 帳票ヘッダー

```tsx
// components/reports/ReportHeader.tsx
const ReportHeader: React.FC<ReportHeaderProps> = ({
  title,
  period,
  storeName,
  exportOptions,
}) => {
  return (
    <Box sx={{ mb: 4 }}>
      <Grid container spacing={2} alignItems="center">
        <Grid item xs={12} md={6}>
          <Typography variant="h6">{title}</Typography>
          <Typography variant="body2" color="text.secondary">
            期間: {period}
          </Typography>
          <Typography variant="body2" color="text.secondary">
            店舗: {storeName}
          </Typography>
        </Grid>
        <Grid item xs={12} md={6} sx={{ textAlign: "right" }}>
          <ButtonGroup variant="outlined" size="small">
            <Button startIcon={<PictureAsPdfIcon />}>PDF出力</Button>
            <Button startIcon={<TableViewIcon />}>CSV出力</Button>
            <Button startIcon={<PrintIcon />}>印刷</Button>
          </ButtonGroup>
        </Grid>
      </Grid>
    </Box>
  );
};
```

## 2. 帳票種類別デザイン

### 2.1 予約統計レポート

```tsx
// components/reports/ReservationStatistics.tsx
const ReservationStatistics: React.FC = () => {
  return (
    <ReportLayout>
      <ReportHeader title="予約統計レポート" {...headerProps} />

      <Grid container spacing={3}>
        <Grid item xs={12} md={6}>
          <Card>
            <CardHeader title="予約状況サマリー" />
            <CardContent>
              <TableContainer>
                <Table size="small">
                  <TableBody>
                    <TableRow>
                      <TableCell>総予約数</TableCell>
                      <TableCell align="right">123件</TableCell>
                    </TableRow>
                    <TableRow>
                      <TableCell>キャンセル率</TableCell>
                      <TableCell align="right">5.2%</TableCell>
                    </TableRow>
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>

        <Grid item xs={12}>
          <Card>
            <CardHeader title="時間帯別予約数" />
            <CardContent>
              <Chart
                type="bar"
                data={hourlyData}
                options={chartOptions}
                height={300}
              />
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </ReportLayout>
  );
};
```

### 2.2 待ち時間分析レポート

```tsx
// components/reports/WaitingTimeAnalysis.tsx
const WaitingTimeAnalysis: React.FC = () => {
  return (
    <ReportLayout>
      <ReportHeader title="待ち時間分析レポート" {...headerProps} />

      <Grid container spacing={3}>
        <Grid item xs={12}>
          <Card>
            <CardHeader
              title="時間帯別平均待ち時間"
              action={
                <FormControl size="small">
                  <Select value={period} onChange={handlePeriodChange}>
                    <MenuItem value="daily">日次</MenuItem>
                    <MenuItem value="weekly">週次</MenuItem>
                    <MenuItem value="monthly">月次</MenuItem>
                  </Select>
                </FormControl>
              }
            />
            <CardContent>
              <LineChart data={waitingTimeData} height={300} />
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </ReportLayout>
  );
};
```

### 2.3 スタッフ実績レポート

```tsx
// components/reports/StaffPerformance.tsx
const StaffPerformance: React.FC = () => {
  return (
    <ReportLayout>
      <ReportHeader title="スタッフ実績レポート" {...headerProps} />

      <DataGrid
        rows={staffData}
        columns={[
          { field: "name", headerName: "スタッフ名", width: 150 },
          { field: "totalCustomers", headerName: "対応件数", width: 130 },
          { field: "avgServiceTime", headerName: "平均対応時間", width: 130 },
          {
            field: "satisfaction",
            headerName: "顧客満足度",
            renderCell: (params) => (
              <Rating value={params.value} readOnly size="small" />
            ),
          },
        ]}
        autoHeight
        density="compact"
        sx={{
          "& .MuiDataGrid-cell": {
            fontSize: "0.875rem",
          },
        }}
      />
    </ReportLayout>
  );
};
```

## 3. 帳票出力オプション

### 3.1 PDF 出力設定

```tsx
// utils/pdfExport.ts
const pdfExportOptions = {
  pageSize: "A4",
  margin: {
    top: 20,
    right: 20,
    bottom: 20,
    left: 20,
  },
  fonts: {
    normal: "Roboto",
    bold: "Roboto-Bold",
  },
  header: {
    height: "50px",
  },
  footer: {
    height: "30px",
  },
};
```

### 3.2 CSV 出力設定

```tsx
// utils/csvExport.ts
const csvExportOptions = {
  delimiter: ",",
  encoding: "utf-8",
  headers: true,
  dateFormat: "YYYY-MM-DD HH:mm:ss",
};
```

## 4. レスポンシブ対応

```tsx
// components/reports/ResponsiveReport.tsx
const ResponsiveReport: React.FC = () => {
  const isMobile = useMediaQuery((theme) => theme.breakpoints.down("sm"));

  return (
    <Box
      sx={{
        width: "100%",
        overflowX: "auto",
        "& .MuiTable-root": {
          minWidth: isMobile ? 500 : "auto",
        },
      }}
    >
      {/* レポートコンテンツ */}
    </Box>
  );
};
```

## 5. データ更新設定

```tsx
// hooks/useReportData.ts
const useReportData = (reportType: string, options: ReportOptions) => {
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState<ReportData>(null);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      try {
        const response = await api.getReportData(reportType, options);
        setData(response.data);
      } catch (error) {
        console.error("レポートデータの取得に失敗しました", error);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [reportType, options]);

  return { data, loading };
};
```
