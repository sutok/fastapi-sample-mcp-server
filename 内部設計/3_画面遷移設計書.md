# 画面遷移設計書

## 1. 概要

本システムの画面遷移フローを定義します。ユーザーの操作性と UX を最適化するため、以下の設計方針に基づいて実装を行います。

## 2. 画面一覧

### 2.1 共通コンポーネント

- ヘッダー（`Header.tsx`）
  - ロゴ
  - メインナビゲーション
  - ユーザーメニュー
- フッター（`Footer.tsx`）
  - コピーライト
  - サイトマップ
  - お問い合わせリンク

### 2.2 認証関連画面

- ログイン画面（`/auth/login`）
- 新規登録画面（`/auth/signup`）
- パスワードリセット画面（`/auth/reset-password`）
- メール確認画面（`/auth/verify-email`）

### 2.3 予約関連画面

- 予約一覧画面（`/reservations`）
- 予約詳細画面（`/reservations/:id`）
- 予約作成画面（`/reservations/new`）
- 予約編集画面（`/reservations/:id/edit`）
- 予約確認画面（`/reservations/confirm`）
- 予約完了画面（`/reservations/complete`）

### 2.4 ユーザー関連画面

- プロフィール画面（`/profile`）
- プロフィール編集画面（`/profile/edit`）
- 設定画面（`/settings`）

### 2.5 管理者画面

- ダッシュボード（`/admin`）
- ユーザー管理（`/admin/users`）
- 予約管理（`/admin/reservations`）
- システム設定（`/admin/settings`）

## 3. 画面遷移フロー

### 3.1 認証フロー

```mermaid
graph TD
    A[ログイン画面] --> B{認証成功?}
    B -->|Yes| C[ホーム画面]
    B -->|No| A
    A --> D[新規登録画面]
    D --> E{登録成功?}
    E -->|Yes| F[メール確認画面]
    E -->|No| D
    A --> G[パスワードリセット画面]
```

### 3.2 予約フロー

```mermaid
graph TD
    A[予約一覧] --> B[予約作成]
    B --> C[日時選択]
    C --> D[オプション選択]
    D --> E[予約確認]
    E --> F{予約成功?}
    F -->|Yes| G[予約完了]
    F -->|No| E
    A --> H[予約詳細]
    H --> I[予約編集]
    H --> J[予約キャンセル]
```

### 3.3 システム管理フロー

```mermaid
graph TD
    A[システム管理ダッシュボード] --> B[企業管理]
    A --> C[店舗管理]
    A --> D[ユーザー管理]
    A --> E[システム設定]

    B --> B1[企業一覧]
    B1 --> B2[企業詳細]
    B2 --> B3[企業編集]
    B2 --> B4[企業停止/再開]

    C --> C1[店舗一覧]
    C1 --> C2[店舗詳細]
    C2 --> C3[店舗編集]
    C2 --> C4[店舗停止/再開]

    D --> D1[ユーザー一覧]
    D1 --> D2[ユーザー詳細]
    D2 --> D3[ユーザー編集]
    D2 --> D4[アカウント停止/再開]

    E --> E1[基本設定]
    E --> E2[通知設定]
    E --> E3[セキュリティ設定]
    E --> E4[API設定]
```

### 3.4 店舗管理フロー

```mermaid
graph TD
    A[店舗管理ダッシュボード] --> B[予約管理]
    A --> C[スタッフ管理]
    A --> D[店舗設定]
    A --> E[レポート]

    B --> B1[予約一覧]
    B1 --> B2[予約詳細]
    B2 --> B3[予約編集]
    B2 --> B4[予約キャンセル]
    B --> B5[予約カレンダー]
    B --> B6[待ち時間管理]

    C --> C1[スタッフ一覧]
    C1 --> C2[スタッフ詳細]
    C2 --> C3[スタッフ編集]
    C2 --> C4[権限設定]
    C --> C5[シフト管理]

    D --> D1[基本情報設定]
    D --> D2[営業時間設定]
    D --> D3[予約枠設定]
    D --> D4[通知設定]

    E --> E1[予約統計]
    E --> E2[利用実績]
    E --> E3[キャンセル分析]
    E --> E4[待ち時間分析]
```

## 4. 画面レイアウト

### 4.1 共通レイアウト

```tsx
// layouts/MainLayout.tsx
const MainLayout: React.FC = ({ children }) => {
  return (
    <div className="min-h-screen">
      <Header />
      <main className="container mx-auto px-4 py-8">{children}</main>
      <Footer />
    </div>
  );
};
```

### 4.2 認証レイアウト

```tsx
// layouts/AuthLayout.tsx
const AuthLayout: React.FC = ({ children }) => {
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="max-w-md mx-auto p-6">
        <div className="bg-white rounded-lg shadow-lg p-8">{children}</div>
      </div>
    </div>
  );
};
```

## 5. コンポーネント設計

### 5.1 共通コンポーネント

```tsx
// components/Button.tsx
interface ButtonProps {
  variant: "primary" | "secondary" | "danger";
  size: "sm" | "md" | "lg";
  children: React.ReactNode;
  onClick?: () => void;
  disabled?: boolean;
}

const Button: React.FC<ButtonProps> = ({
  variant,
  size,
  children,
  onClick,
  disabled,
}) => {
  // ...
};
```

### 5.2 フォームコンポーネント

```tsx
// components/forms/Input.tsx
interface InputProps {
  type: "text" | "email" | "password" | "number";
  label: string;
  value: string;
  onChange: (value: string) => void;
  error?: string;
  required?: boolean;
}

const Input: React.FC<InputProps> = ({
  type,
  label,
  value,
  onChange,
  error,
  required,
}) => {
  // ...
};
```

## 6. 状態管理

### 6.1 グローバル状態

```tsx
// store/auth.ts
interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  loading: boolean;
}

const authSlice = createSlice({
  name: "auth",
  initialState,
  reducers: {
    // ...
  },
});
```

### 6.2 ローカル状態

```tsx
// hooks/useReservationForm.ts
const useReservationForm = (initialData?: Reservation) => {
  const [formData, setFormData] = useState({
    date: "",
    time: "",
    // ...
  });

  const validate = () => {
    // ...
  };

  const handleSubmit = async () => {
    // ...
  };

  return {
    formData,
    setFormData,
    validate,
    handleSubmit,
  };
};
```

# 受付表示画面 詳細設計書

## 1. 画面概要

- 目的
- 対象ユーザー
- 表示条件

## 2. 画面レイアウト

- 画面構成図
- コンポーネント配置
- レスポンシブ対応

## 3. 表示項目定義

- 現在番号表示
  - フォントサイズ
  - 表示形式
  - 更新タイミング
- 待ち人数表示
  - 表示形式
  - 更新間隔
- 予想待ち時間
  - 計算ロジック
  - 表示形式

## 4. インタラクション設計

- 画面更新方式
- アニメーション
- エラー表示
- ローディング表示

## 5. 技術仕様

- コンポーネント構成
- データフロー
- API インターフェース
- 状態管理

## 7. 管理画面仕様

### 7.1 システム管理画面

#### ダッシュボード

- システム全体の状態監視
- 重要指標（KPI）の表示
- アラート・通知の表示
- クイックアクション

#### 企業管理

- 企業の登録・編集・停止
- 契約状況の管理
- 利用状況の確認
- 請求情報の管理

#### 店舗管理

- 店舗の登録・編集・停止
- 店舗グループの管理
- 店舗別設定の管理
- 利用状況の監視

#### ユーザー管理

- システム管理者の管理
- 企業管理者の管理
- アクセス権限の設定
- アカウントのロック/解除

#### システム設定

- システム基本設定
- セキュリティ設定
- 通知設定
- API 設定・管理

### 7.2 店舗管理画面

#### ダッシュボード

- 当日の予約状況
- 待ち時間情報
- スタッフ出勤状況
- 重要通知の表示

#### 予約管理

- 予約一覧表示
- カレンダー表示
- 予約詳細確認/編集
- 待ち時間管理

#### スタッフ管理

- スタッフ一覧
- シフト管理
- 権限設定
- 実績管理

#### 店舗設定

- 基本情報設定
- 営業時間設定
- 予約枠設定
- 通知設定

#### レポート

- 予約統計
- 利用実績
- キャンセル分析
- 待ち時間分析

# 帳票設計仕様書（MUI 準拠）

## 1. 共通帳票コンポーネント

### 1.1 帳票ベースレイアウト

```tsx
// components/reports/ReportLayout.tsx
const ReportLayout: React.FC = ({ children }) => {
  return (
    <Paper sx={{ p: 3, width: "100%" }}>
      <Box sx={{ mb: 3 }}>
        <Typography variant="h5" component="h2">
          {title}
        </Typography>
        <Divider sx={{ my: 2 }} />
      </Box>
      {children}
      <Box sx={{ mt: 3, textAlign: "right" }}>
        <Typography variant="caption">
          出力日時: {new Date().toLocaleString()}
        </Typography>
      </Box>
    </Paper>
  );
};
```

### 1.2 帳票ヘッダー

```tsx
// components/reports/ReportHeader.tsx
const ReportHeader: React.FC<ReportHeaderProps> = ({
  title,
  period,
  storeName,
  exportOptions,
}) => {
  return (
    <Box sx={{ mb: 4 }}>
      <Grid container spacing={2} alignItems="center">
        <Grid item xs={12} md={6}>
          <Typography variant="h6">{title}</Typography>
          <Typography variant="body2" color="text.secondary">
            期間: {period}
          </Typography>
          <Typography variant="body2" color="text.secondary">
            店舗: {storeName}
          </Typography>
        </Grid>
        <Grid item xs={12} md={6} sx={{ textAlign: "right" }}>
          <ButtonGroup variant="outlined" size="small">
            <Button startIcon={<PictureAsPdfIcon />}>PDF出力</Button>
            <Button startIcon={<TableViewIcon />}>CSV出力</Button>
            <Button startIcon={<PrintIcon />}>印刷</Button>
          </ButtonGroup>
        </Grid>
      </Grid>
    </Box>
  );
};
```

## 2. 帳票種類別デザイン

### 2.1 予約統計レポート

```tsx
// components/reports/ReservationStatistics.tsx
const ReservationStatistics: React.FC = () => {
  return (
    <ReportLayout>
      <ReportHeader title="予約統計レポート" {...headerProps} />

      <Grid container spacing={3}>
        <Grid item xs={12} md={6}>
          <Card>
            <CardHeader title="予約状況サマリー" />
            <CardContent>
              <TableContainer>
                <Table size="small">
                  <TableBody>
                    <TableRow>
                      <TableCell>総予約数</TableCell>
                      <TableCell align="right">123件</TableCell>
                    </TableRow>
                    <TableRow>
                      <TableCell>キャンセル率</TableCell>
                      <TableCell align="right">5.2%</TableCell>
                    </TableRow>
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>

        <Grid item xs={12}>
          <Card>
            <CardHeader title="時間帯別予約数" />
            <CardContent>
              <Chart
                type="bar"
                data={hourlyData}
                options={chartOptions}
                height={300}
              />
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </ReportLayout>
  );
};
```

### 2.2 待ち時間分析レポート

```tsx
// components/reports/WaitingTimeAnalysis.tsx
const WaitingTimeAnalysis: React.FC = () => {
  return (
    <ReportLayout>
      <ReportHeader title="待ち時間分析レポート" {...headerProps} />

      <Grid container spacing={3}>
        <Grid item xs={12}>
          <Card>
            <CardHeader
              title="時間帯別平均待ち時間"
              action={
                <FormControl size="small">
                  <Select value={period} onChange={handlePeriodChange}>
                    <MenuItem value="daily">日次</MenuItem>
                    <MenuItem value="weekly">週次</MenuItem>
                    <MenuItem value="monthly">月次</MenuItem>
                  </Select>
                </FormControl>
              }
            />
            <CardContent>
              <LineChart data={waitingTimeData} height={300} />
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </ReportLayout>
  );
};
```

### 2.3 スタッフ実績レポート

```tsx
// components/reports/StaffPerformance.tsx
const StaffPerformance: React.FC = () => {
  return (
    <ReportLayout>
      <ReportHeader title="スタッフ実績レポート" {...headerProps} />

      <DataGrid
        rows={staffData}
        columns={[
          { field: "name", headerName: "スタッフ名", width: 150 },
          { field: "totalCustomers", headerName: "対応件数", width: 130 },
          { field: "avgServiceTime", headerName: "平均対応時間", width: 130 },
          {
            field: "satisfaction",
            headerName: "顧客満足度",
            renderCell: (params) => (
              <Rating value={params.value} readOnly size="small" />
            ),
          },
        ]}
        autoHeight
        density="compact"
        sx={{
          "& .MuiDataGrid-cell": {
            fontSize: "0.875rem",
          },
        }}
      />
    </ReportLayout>
  );
};
```

## 3. 帳票出力オプション

### 3.1 PDF 出力設定

```tsx
// utils/pdfExport.ts
const pdfExportOptions = {
  pageSize: "A4",
  margin: {
    top: 20,
    right: 20,
    bottom: 20,
    left: 20,
  },
  fonts: {
    normal: "Roboto",
    bold: "Roboto-Bold",
  },
  header: {
    height: "50px",
  },
  footer: {
    height: "30px",
  },
};
```

### 3.2 CSV 出力設定

```tsx
// utils/csvExport.ts
const csvExportOptions = {
  delimiter: ",",
  encoding: "utf-8",
  headers: true,
  dateFormat: "YYYY-MM-DD HH:mm:ss",
};
```

## 4. レスポンシブ対応

```tsx
// components/reports/ResponsiveReport.tsx
const ResponsiveReport: React.FC = () => {
  const isMobile = useMediaQuery((theme) => theme.breakpoints.down("sm"));

  return (
    <Box
      sx={{
        width: "100%",
        overflowX: "auto",
        "& .MuiTable-root": {
          minWidth: isMobile ? 500 : "auto",
        },
      }}
    >
      {/* レポートコンテンツ */}
    </Box>
  );
};
```

## 5. データ更新設定

```tsx
// hooks/useReportData.ts
const useReportData = (reportType: string, options: ReportOptions) => {
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState<ReportData>(null);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      try {
        const response = await api.getReportData(reportType, options);
        setData(response.data);
      } catch (error) {
        console.error("レポートデータの取得に失敗しました", error);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [reportType, options]);

  return { data, loading };
};
```
