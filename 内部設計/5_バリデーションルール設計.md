# バリデーションルール設計

## 1. 共通バリデーションルール

### 1.1 企業（Company）

| フィールド   | ルール                                                              | エラーメッセージ                                                       |
| ------------ | ------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| company_name | - 必須<br>- 1-100 文字                                              | - 会社名は必須です<br>- 会社名は 1-100 文字で入力してください          |
| email        | - 必須<br>- メールアドレス形式<br>- 最大 255 文字                   | - メールアドレスは必須です<br>- 有効なメールアドレスを入力してください |
| phone        | - 必須<br>- 半角数字とハイフンのみ<br>- パターン: `^[0-9-]{10,15}$` | - 電話番号は必須です<br>- 電話番号は半角数字とハイフンのみ使用可能です |

### 1.2 店舗（Store）

| フィールド | ルール                                                              | エラーメッセージ                                                       |
| ---------- | ------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| store_name | - 必須<br>- 1-100 文字                                              | - 店舗名は必須です<br>- 店舗名は 1-100 文字で入力してください          |
| email      | - 必須<br>- メールアドレス形式<br>- 最大 255 文字                   | - メールアドレスは必須です<br>- 有効なメールアドレスを入力してください |
| phone      | - 必須<br>- 半角数字とハイフンのみ<br>- パターン: `^[0-9-]{10,15}$` | - 電話番号は必須です<br>- 電話番号は半角数字とハイフンのみ使用可能です |
| company_id | - 必須<br>- 存在する企業 ID                                         | - 企業 ID は必須です<br>- 指定された企業が存在しません                 |

### 1.3 ユーザー（User）

| フィールド | ルール                                                                                | エラーメッセージ                                                       |
| ---------- | ------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| user_name  | - 必須<br>- 1-50 文字                                                                 | - ユーザー名は必須です<br>- ユーザー名は 1-50 文字で入力してください   |
| email      | - 必須<br>- メールアドレス形式<br>- 最大 255 文字                                     | - メールアドレスは必須です<br>- 有効なメールアドレスを入力してください |
| role       | - 必須<br>- 列挙値: ["system_admin", "company_admin", "store_admin", "staff", "user"] | - 役割は必須です<br>- 指定された役割は無効です                         |
| company_id | - 必須<br>- 存在する企業 ID                                                           | - 企業 ID は必須です<br>- 指定された企業が存在しません                 |
| store_id   | - 必須<br>- 存在する店舗 ID                                                           | - 店舗 ID は必須です<br>- 指定された店舗が存在しません                 |

### 1.4 受付（Reception）

| フィールド     | ルール                                                                   | エラーメッセージ                                                            |
| -------------- | ------------------------------------------------------------------------ | --------------------------------------------------------------------------- |
| number         | - 必須<br>- 正の整数                                                     | - 受付番号は必須です<br>- 受付番号は正の整数で入力してください              |
| status         | - 必須<br>- 列挙値: ["waiting", "in_progress", "completed", "cancelled"] | - ステータスは必須です<br>- 指定されたステータスは無効です                  |
| estimated_time | - 必須<br>- 0 以上の整数<br>- 最大 1440（24 時間）                       | - 推定待ち時間は必須です<br>- 推定待ち時間は 0 以上の整数で入力してください |

## 2. 実装方針

### 2.1 バックエンド（FastAPI + Pydantic）

```python
from pydantic import BaseModel, EmailStr, constr, validator
from enum import Enum

class UserRole(str, Enum):
    SYSTEM_ADMIN = "system_admin"
    COMPANY_ADMIN = "company_admin"
    STORE_ADMIN = "store_admin"
    STAFF = "staff"
    USER = "user"

class ReceptionStatus(str, Enum):
    WAITING = "waiting"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    CANCELLED = "cancelled"
```

### 2.2 フロントエンド（React + Zod）

```typescript
import { z } from "zod";

const UserRole = z.enum([
  "system_admin",
  "company_admin",
  "store_admin",
  "staff",
  "user",
]);

const ReceptionStatus = z.enum([
  "waiting",
  "in_progress",
  "completed",
  "cancelled",
]);
```

## 3. 共通正規表現パターン

```typescript
const PATTERNS = {
  PHONE: /^[0-9-]{10,15}$/,
  EMAIL: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,
  USERNAME: /^[a-zA-Z0-9_-]{1,50}$/,
} as const;
```

## 4. 注意事項

1. バックエンドとフロントエンドの両方でバリデーションを実装する
2. フロントエンドではユーザー体験を向上させるための即時バリデーション
3. バックエンドではセキュリティのための厳密なバリデーション
4. エラーメッセージは多言語対応を考慮
5. バリデーションルールの更新時は両方の実装を同期して更新
