# 環境構築仕様書

## Firebase Local Emulator Suite設定

### 1. 前提条件
- Firebase CLIのインストール
```bash
npm install -g firebase-tools
```

### 2. 初期設定
```bash
# Firebaseへのログイン
firebase login

# プロジェクトの初期化
firebase init emulators
```

### 3. エミュレータの設定
firebase.json の設定例：
```json
{
  "emulators": {
    "auth": {
      "port": 9099
    },
    "firestore": {
      "port": 8080
    },
    "ui": {
      "port": 4000
    }
  }
}
```

```
firebase --config firebase.d/config/firebase.json emulators:start 
```

### 4. 開発環境での設定

#### バックエンド（FastAPI）
```python
# backend/app/core/config.py
from firebase_admin import credentials, initialize_app

cred = credentials.Certificate("path/to/service-account.json")
firebase_app = initialize_app(cred)

if os.getenv("FIREBASE_AUTH_EMULATOR_HOST"):
    auth_url = f"http://{os.getenv('FIREBASE_AUTH_EMULATOR_HOST')}/emulator/v1/projects/{PROJECT_ID}"
    os.environ["FIREBASE_AUTH_EMULATOR_HOST"] = auth_url
```

#### フロントエンド（React）
```typescript
// frontend/src/firebase/config.ts
import { initializeApp } from 'firebase/app';
import { connectAuthEmulator, getAuth } from 'firebase/auth';

const firebaseConfig = {
  // your config
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

if (process.env.REACT_APP_USE_FIREBASE_EMULATOR === 'true') {
  connectAuthEmulator(auth, 'http://localhost:9099');
}
```

### 5. 起動方法
```bash
# エミュレータの起動
npm run emulator:start

# 開発環境の起動（エミュレータ含む）
npm run dev
```
```

この構成のメリット：

1. **一元管理**
   - Firebase関連の設定やデータを一箇所で管理
   - チーム間での共有が容易

2. **開発効率**
   - 単一のコマンドで全環境を起動可能
   - エミュレータデータの永続化が容易

3. **柔軟性**
   - 本番環境への切り替えが容易
   - 設定の変更が一箇所で完結

4. **保守性**
   - 設定ファイルの管理が容易
   - トラブルシューティングが簡単

