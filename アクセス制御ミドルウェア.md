## 1.アクセス制御ミドルウェア
```python
class AccessControlMiddleware:
    async def __call__(self, request: Request, call_next):
        # トークンからユーザー情報取得
        user = await get_current_user(request)
        
        # 企業・店舗レベルのアクセス制御
        if not await validate_access(user, request):
            raise HTTPException(status_code=403)
            
        # ロールベースの権限チェック
        if not await validate_role_permission(user, request):
            raise HTTPException(status_code=403)
        
        return await call_next(request)
```
